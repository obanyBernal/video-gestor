<!-- views/index.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel de Administraci칩n - Carga de Videos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background: #f4f4f4;
    }

    h1 {
      color: #333;
    }

    form {
      margin-bottom: 2rem;
    }

    input[type="file"] {
      margin-bottom: 1rem;
    }

    #status {
      margin-top: 1rem;
      font-weight: bold;
    }

    ul {
      margin-top: 2rem;
    }

    li {
      margin-bottom: 5px;
    }

    video {
      width: 300px;
      margin-top: 10px;
      display: block;
    }
  </style>
</head>
<body>
  <h1>游꿟 Panel de Administraci칩n de Videos</h1>

  <form id="uploadForm">
    <input type="file" name="video" accept="video/mp4" required />
    <br />
    <button type="submit">Subir Video</button>
    <div id="status"></div>
  </form>

  <h2>游늬 Videos disponibles:</h2>
  <ul id="videoList"></ul>

  <script>
    const form = document.getElementById('uploadForm');
    const status = document.getElementById('status');
    const videoList = document.getElementById('videoList');

    // Cargar lista de videos
    function loadVideos() {
      fetch('/list')
        .then(res => res.json())
        .then(files => {
          videoList.innerHTML = '';
          files.forEach(file => {
            const li = document.createElement('li');
            li.textContent = file;
            const video = document.createElement('video');
            video.src = `/videos/${file}`;
            video.controls = true;
            li.appendChild(video);
            videoList.appendChild(li);
          });
        });
    }

    loadVideos();

    // Manejar env칤o del formulario
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const fileInput = form.querySelector('input[type="file"]');
      const file = fileInput.files[0];
      if (!file) return;

      const formData = new FormData();
      formData.append('video', file);

      fetch('/upload', {
        method: 'POST',
        body: formData
      })
      .then(res => res.text())
      .then(msg => {
        status.textContent = msg;
        fileInput.value = '';
        loadVideos();
      })
      .catch(err => {
        status.textContent = 'Error al subir el video';
        console.error(err);
      });
    });
  </script>
  <div id="sync-status" style="margin-top: 2rem; color: #555;"></div>

<script>
  const localServerURL = "http://192.168.1.100:3000/local-sync-status"; // Cambia a la IP real de tu red

  function checkLocalSync() {
    fetch(localServerURL)
      .then(res => res.text())
      .then(timestamp => {
        const lastDate = new Date(timestamp);
        const now = new Date();
        const diffMin = Math.round((now - lastDate) / 60000);

        const statusEl = document.getElementById('sync-status');
        if (diffMin <= 60) {
          statusEl.innerHTML = `游릭 Servidor local sincronizado hace ${diffMin} minutos`;
        } else {
          statusEl.innerHTML = `游댮 칔ltima sincronizaci칩n fue hace m치s de ${diffMin} minutos`;
        }
      })
      .catch(err => {
        document.getElementById('sync-status').innerHTML = `游댮 No se pudo contactar al servidor local`;
      });
  }

  checkLocalSync();
</script>

</body>
</html>
